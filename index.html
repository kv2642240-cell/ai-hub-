<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE AI HUB | GST Ledger</title>
    <style>
        :root { --primary: #6366f1; --bg: #0b0f1a; --card: #161b2c; --green: #10b981; --red: #ef4444; --yellow: #f59e0b; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: white; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .card { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid #2d3748; width: 100%; max-width: 450px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        input { width: 90%; padding: 12px; border-radius: 10px; border: 1px solid #2d3748; background: #1a202c; color: white; margin-bottom: 10px; outline: none; text-align: center; font-size: 16px; }
        .btn { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; color: white; margin-bottom: 8px; }
        .search-results { text-align: left; background: rgba(255,255,255,0.05); border-radius: 10px; padding: 10px; margin-bottom: 15px; display: none; }
        .user-link { display: block; padding: 10px; color: var(--yellow); text-decoration: none; border-bottom: 1px solid #2d3748; cursor: pointer; display: flex; justify-content: space-between; }
        .list-area { text-align: left; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 12px; margin-top: 10px; max-height: 150px; overflow-y: auto; }
        .item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #2d3748; font-size: 13px; }
        #billModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; color: black; padding: 20px; z-index: 1000; overflow-y: auto; }
    </style>
</head>
<body>

    <div id="homePage" class="card">
        <h1 style="color: var(--primary); margin-bottom: 5px;">THE AI HUB</h1>
        <p style="color: #94a3b8; font-size: 13px;">By Harshwardhan Singh Lodhi | IIT Patna</p>
        
        <input type="text" id="userInput" onkeyup="searchDebt()" placeholder="Search Customer Name...">
        
        <div id="searchResults" class="search-results">
            <p style="font-size: 11px; color: gray; margin-bottom: 5px;">Pending Udhari Accounts:</p>
            <div id="userSuggestions"></div>
        </div>

        <button onclick="enterDash()" class="btn" style="background: var(--primary);">üìÇ OPEN DASHBOARD</button>
    </div>

    <div id="dashPage" style="display: none; width: 100%; max-width: 480px;">
        <div class="card" style="border-top: 4px solid var(--primary);">
            <h2 id="userHeading" style="margin: 0; color: #fff;"></h2>
            <p id="totalUdhariDisplay" style="color: var(--yellow); font-weight: bold; font-size: 18px; margin: 10px 0;"></p>
            <button onclick="generateBill()" class="btn" style="background: #fff; color: #000; border: 1px solid #000;">üìÑ GENERATE GST BILL</button>
        </div>

        <div class="card">
            <input type="number" id="amtInput" placeholder="Enter Amount (‚Çπ)">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                <button onclick="addData('udhari')" class="btn" style="background: var(--yellow); color: black;">+ Udhari</button>
                <button onclick="addData('profit')" class="btn" style="background: var(--green);">+ Profit</button>
                <button onclick="addData('loss')" class="btn" style="background: var(--red);">+ Loss</button>
            </div>
        </div>

        <div class="card" style="text-align: left;">
            <h4 style="color: var(--yellow); margin: 0;">üü° UDHARI LIST</h4>
            <div id="udhariList" class="list-area"></div>
            <h4 style="color: var(--green); margin: 15px 0 0 0;">üü¢ PROFIT LIST</h4>
            <div id="profitList" class="list-area"></div>
            <h4 style="color: var(--red); margin: 15px 0 0 0;">üî¥ LOSS LIST</h4>
            <div id="lossList" class="list-area"></div>
        </div>

        <button onclick="location.reload()" class="btn" style="background: #334155; margin-bottom: 50px;">‚¨ÖÔ∏è BACK TO SEARCH</button>
    </div>

    <div id="billModal">
        <center><h2>THE AI HUB - GST INVOICE</h2><hr></center>
        <p><strong>Customer:</strong> <span id="billCustName"></span></p>
        <p><strong>Date:</strong> <span id="billDate"></span></p>
        <table border="1" style="width:100%; border-collapse: collapse; margin-top:10px;">
            <thead><tr><th>Description</th><th>Amount (‚Çπ)</th></tr></thead>
            <tbody id="billItems"></tbody>
            <tfoot>
                <tr><th>Subtotal</th><td id="sub"></td></tr>
                <tr><th>GST (18%)</th><td id="gst"></td></tr>
                <tr><th>Total Payable</th><td id="grand" style="font-weight:bold;"></td></tr>
            </tfoot>
        </table>
        <div style="margin-top: 20px; text-align:center;">
            <button onclick="window.print()" style="padding:10px 20px; background:blue; color:white;">Print/PDF</button>
            <button onclick="document.getElementById('billModal').style.display='none'" style="padding:10px 20px; background:grey; color:white;">Close</button>
        </div>
    </div>

    <script>
        let currentAccount = "";

        function searchDebt() {
            let input = document.getElementById('userInput').value.toLowerCase();
            let resultsDiv = document.getElementById('searchResults');
            let suggestions = document.getElementById('userSuggestions');
            suggestions.innerHTML = "";
            if(!input) { resultsDiv.style.display = 'none'; return; }
            let found = false;
            for(let i=0; i<localStorage.length; i++) {
                let key = localStorage.key(i);
                if(key.startsWith("hub_") && key.endsWith("_udhari")) {
                    let name = key.split("_")[1];
                    if(name.includes(input)) {
                        let data = JSON.parse(localStorage.getItem(key));
                        let total = data.reduce((s, item) => s + item.amt, 0);
                        if(total > 0) {
                            found = true;
                            suggestions.innerHTML += `<div class="user-link" onclick="fillSearch('${name}')"><span>üë§ ${name.toUpperCase()}</span> <b>‚Çπ${total}</b></div>`;
                        }
                    }
                }
            }
            resultsDiv.style.display = found ? 'block' : 'none';
        }

        function fillSearch(n) { document.getElementById('userInput').value = n; enterDash(); }

        function enterDash() {
            let name = document.getElementById('userInput').value.trim().toLowerCase();
            if(!name) return alert("Enter Name!");
            currentAccount = name;
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('dashPage').style.display = 'block';
            document.getElementById('userHeading').innerText = "Dashboard: " + name.toUpperCase();
            loadData();
        }

        function addData(type) {
            let amt = parseFloat(document.getElementById('amtInput').value);
            if(!amt) return alert("Enter Amount!");
            let key = "hub_" + currentAccount + "_" + type;
            let db = JSON.parse(localStorage.getItem(key)) || [];
            db.push({ id: Date.now(), amt, date: new Date().toLocaleDateString() });
            localStorage.setItem(key, JSON.stringify(db));
            document.getElementById('amtInput').value = "";
            loadData();
        }

        function loadData() {
            let totalU = 0;
            ['udhari', 'profit', 'loss'].forEach(t => {
                let key = "hub_" + currentAccount + "_" + t;
                let data = JSON.parse(localStorage.getItem(key)) || [];
                let list = document.getElementById(t + 'List');
                list.innerHTML = data.length ? "" : "<p style='color:gray; font-size:11px; text-align:center;'>No record</p>";
                data.forEach(item => {
                    if(t === 'udhari') totalU += item.amt;
                    list.innerHTML += `<div class="item"><span>üìÖ ${item.date} - ‚Çπ${item.amt}</span><button onclick="del('${t}',${item.id})" style="color:red; background:none; border:none; cursor:pointer;">‚úï</button></div>`;
                });
            });
            document.getElementById('totalUdhariDisplay').innerText = "Total Udhari: ‚Çπ" + totalU;
        }

        function del(t, id) {
            let key = "hub_" + currentAccount + "_" + t;
            let db = JSON.parse(localStorage.getItem(key)).filter(i => i.id !== id);
            localStorage.setItem(key, JSON.stringify(db));
            loadData();
        }

        function generateBill() {
            let data = JSON.parse(localStorage.getItem("hub_" + currentAccount + "_udhari")) || [];
            if(!data.length) return alert("No udhari entries!");
            document.getElementById('billCustName').innerText = currentAccount.toUpperCase();
            document.getElementById('billDate').innerText = new Date().toLocaleDateString();
            let sub = 0; let rows = "";
            data.forEach(i => { rows += `<tr><td>Transaction (${i.date})</td><td>‚Çπ${i.amt}</td></tr>`; sub += i.amt; });
            document.getElementById('billItems').innerHTML = rows;
            document.getElementById('sub').innerText = "‚Çπ" + sub;
            document.getElementById('gst').innerText = "‚Çπ" + (sub * 0.18).toFixed(2);
            document.getElementById('grand').innerText = "‚Çπ" + (sub * 1.18).toFixed(2);
            document.getElementById('billModal').style.display = 'block';
        }
    </script>
</body>
</html>
