<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE AI HUB | Business ERP</title>
    <style>
        :root { --primary: #6366f1; --bg: #050811; --card: #111827; --green: #10b981; --red: #ef4444; --yellow: #f59e0b; --blue: #3b82f6; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: white; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .card { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid #1f2937; width: 100%; max-width: 500px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        input, select { width: 92%; padding: 12px; border-radius: 10px; border: 1px solid #374151; background: #1a202c; color: white; margin-bottom: 10px; outline: none; }
        .btn { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; color: white; margin-bottom: 8px; transition: 0.2s; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .list-box { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 12px; max-height: 200px; overflow-y: auto; text-align: left; font-size: 13px; }
        .entry { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #1f2937; }
        
        /* GST Bill Modal Styling */
        #billModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; color: black; padding: 40px; box-sizing: border-box; z-index: 1000; overflow-y: auto; }
        .invoice-box { max-width: 800px; margin: auto; border: 1px solid #eee; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    </style>
</head>
<body>

    <div id="loginPage" class="card">
        <h1 style="color: var(--primary); margin: 0;">THE AI HUB</h1>
        <p style="color: #9ca3af; font-size: 14px;">Harshwardhan Singh Lodhi | IIT Patna</p>
        <hr style="border: 0.5px solid #1f2937; margin: 20px 0;">
        
        <label>Customer ka Naam Likhein:</label>
        <input type="text" id="custName" onkeyup="showDebtors()" placeholder="Enter Customer Name">
        
        <div id="debtorList" style="text-align: left; background: rgba(255,165,0,0.1); border-radius: 10px; padding: 10px; display: none; margin-bottom: 10px;">
            <p style="font-size: 11px; color: var(--yellow); margin: 0;">Pending Udhari Accounts Found:</p>
            <div id="suggestions"></div>
        </div>

        <button onclick="openDashboard()" class="btn" style="background: var(--primary);">üìÇ OPEN DASHBOARD</button>
    </div>

    <div id="dashboard" style="display: none; width: 100%; max-width: 520px;">
        <div class="card">
            <h2 id="displayUser" style="margin:0; color: var(--primary);"></h2>
            <p id="stats" style="font-size: 14px; margin: 10px 0; color: #9ca3af;"></p>
            <button onclick="generateInvoice()" class="btn" style="background: white; color: black;">üìÑ GENERATE GST INVOICE</button>
        </div>

        <div class="card">
            <label>Nayi Entry Karein:</label>
            <input type="number" id="amtInput" placeholder="Amount (‚Çπ)">
            <input type="text" id="descInput" placeholder="Item/Reason (e.g. Laptop, Repair)">
            <div class="grid-3">
                <button onclick="saveData('udhari')" class="btn" style="background: var(--yellow); color: black;">Udhari</button>
                <button onclick="saveData('sale')" class="btn" style="background: var(--blue);">Sale</button>
                <button onclick="saveData('profit')" class="btn" style="background: var(--green);">Profit</button>
            </div>
            <button onclick="saveData('loss')" class="btn" style="background: var(--red);">+ Record Loss</button>
        </div>

        <div class="card">
            <h4 style="color: var(--blue); margin: 0;">üîµ SALES & UDHARI HISTORY</h4>
            <div id="historyList" class="list-box"></div>
        </div>

        <button onclick="location.reload()" class="btn" style="background: #374151; margin-bottom: 50px;">‚¨ÖÔ∏è BACK TO SEARCH</button>
    </div>

    <div id="billModal">
        <div class="invoice-box">
            <center>
                <h1>TAX INVOICE</h1>
                <h3>THE AI HUB</h3>
                <p>IIT Patna | Email: kv2642240@gmail.com</p>
                <hr>
            </center>
            <p><strong>Customer:</strong> <span id="invCust"></span></p>
            <p><strong>Date:</strong> <span id="invDate"></span></p>
            <table>
                <thead>
                    <tr><th>Description</th><th>Base Amount</th><th>GST (18%)</th><th>Total</th></tr>
                </thead>
                <tbody id="invRows"></tbody>
                <tfoot>
                    <tr><th colspan="3">Grand Total Payable (Incl. Tax)</th><td id="invTotal" style="font-weight:bold;"></td></tr>
                </tfoot>
            </table>
            <p style="font-size: 12px; color: #666;">* This is a computer-generated invoice for THE AI HUB digital services.</p>
            <div style="margin-top: 30px; text-align: center;">
                <button onclick="window.print()" style="padding: 10px 20px; background: #6366f1; color: white; border:none; border-radius: 5px;">Download / Print PDF</button>
                <button onclick="document.getElementById('billModal').style.display='none'" style="padding: 10px 20px; background: #ccc; border:none; border-radius: 5px;">Close</button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = "";

        function showDebtors() {
            let input = document.getElementById('custName').value.toLowerCase();
            let sug = document.getElementById('suggestions');
            let box = document.getElementById('debtorList');
            sug.innerHTML = "";
            if(!input) { box.style.display = 'none'; return; }
            let found = false;
            for(let i=0; i<localStorage.length; i++) {
                let key = localStorage.key(i);
                if(key.startsWith("erp_") && key.endsWith("_udhari")) {
                    let name = key.split("_")[1];
                    if(name.includes(input)) {
                        let data = JSON.parse(localStorage.getItem(key));
                        let sum = data.reduce((a,b) => a + b.amt, 0);
                        if(sum > 0) {
                            found = true;
                            sug.innerHTML += `<div style="cursor:pointer; padding:5px; border-bottom:1px solid #333;" onclick="fillName('${name}')">üë§ ${name.toUpperCase()} (Baki: ‚Çπ${sum})</div>`;
                        }
                    }
                }
            }
            box.style.display = found ? 'block' : 'none';
        }

        function fillName(n) { document.getElementById('custName').value = n; openDashboard(); }

        function openDashboard() {
            let n = document.getElementById('custName').value.trim().toLowerCase();
            if(!n) return alert("Naam likho!");
            currentUser = n;
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('displayUser').innerText = "Account: " + n.toUpperCase();
            loadHistory();
        }

        function saveData(type) {
            let amt = parseFloat(document.getElementById('amtInput').value);
            let desc = document.getElementById('descInput').value || "General Service";
            if(!amt) return alert("Amount daalo!");
            
            let key = "erp_" + currentUser + "_" + type;
            let db = JSON.parse(localStorage.getItem(key)) || [];
            db.push({ id: Date.now(), amt, desc, date: new Date().toLocaleDateString() });
            localStorage.setItem(key, JSON.stringify(db));
            
            document.getElementById('amtInput').value = "";
            document.getElementById('descInput').value = "";
            loadHistory();
        }

        function loadHistory() {
            let totalU = 0; let totalS = 0;
            let list = document.getElementById('historyList');
            list.innerHTML = "";
            ['udhari', 'sale', 'profit', 'loss'].forEach(t => {
                let data = JSON.parse(localStorage.getItem("erp_" + currentUser + "_" + t)) || [];
                data.forEach(item => {
                    if(t === 'udhari') totalU += item.amt;
                    if(t === 'sale') totalS += item.amt;
                    let color = t === 'udhari' ? 'var(--yellow)' : (t === 'sale' ? 'var(--blue)' : (t === 'profit' ? 'var(--green)' : 'var(--red)'));
                    list.innerHTML += `<div class="entry"><span style="color:${color}">${t.toUpperCase()}</span> <span>${item.desc}</span> <b>‚Çπ${item.amt}</b></div>`;
                });
            });
            document.getElementById('stats').innerText = `Total Sale: ‚Çπ${totalS} | Pending Udhari: ‚Çπ${totalU}`;
        }

        function generateInvoice() {
            let sales = JSON.parse(localStorage.getItem("erp_" + currentUser + "_sale")) || [];
            let udhari = JSON.parse(localStorage.getItem("erp_" + currentUser + "_udhari")) || [];
            let all = [...sales, ...udhari];
            if(!all.length) return alert("Koi entry nahi mili!");

            document.getElementById('invCust').innerText = currentUser.toUpperCase();
            document.getElementById('invDate').innerText = new Date().toLocaleDateString();
            let rows = ""; let grand = 0;
            all.forEach(i => {
                let gst = i.amt * 0.18;
                rows += `<tr><td>${i.desc} (${i.date})</td><td>‚Çπ${i.amt}</td><td>‚Çπ${gst.toFixed(2)}</td><td>‚Çπ${(i.amt + gst).toFixed(2)}</td></tr>`;
                grand += (i.amt + gst);
            });
            document.getElementById('invRows').innerHTML = rows;
            document.getElementById('invTotal').innerText = "‚Çπ" + grand.toFixed(2);
            document.getElementById('billModal').style.display = 'block';
        }
    </script>
</body>
</html>
