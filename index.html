<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE AI HUB | Business Ledger Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #6366f1; --bg: #030712; --card: #111827; --text: #f3f4f6; --accent: #10b981; --danger: #ef4444; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .container { max-width: 600px; margin: auto; }
        
        header { text-align: center; padding: 25px 0; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
        .pill { background: rgba(99, 102, 241, 0.1); color: var(--primary); padding: 5px 12px; border-radius: 50px; font-size: 11px; text-decoration: none; border: 1px solid var(--primary); font-weight: bold; margin: 0 5px; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-value { font-size: 22px; font-weight: 800; margin-top: 5px; }

        .glass-panel { background: rgba(17, 24, 39, 0.7); border: 1px solid rgba(255,255,255,0.05); border-radius: 24px; padding: 20px; margin-bottom: 20px; }
        input, textarea, select { width: 100%; padding: 14px; margin: 10px 0; border-radius: 12px; border: 1px solid #374151; background: #1f2937; color: white; box-sizing: border-box; outline: none; }
        .btn-action { width: 100%; padding: 16px; border-radius: 14px; border: none; font-weight: 800; cursor: pointer; background: var(--primary); color: white; }

        /* Search & Multi-Download */
        #searchResult { margin-top: 15px; padding: 15px; border-radius: 15px; background: rgba(99, 102, 241, 0.05); border: 1px dashed var(--primary); display: none; }
        .dl-all-btn { background: var(--danger); color: white; border: none; padding: 10px; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 15px; margin-bottom: 10px; }

        /* List Items */
        .history-item { background: #111827; padding: 15px; border-radius: 15px; margin-bottom: 10px; border: 1px solid #1f2937; display: flex; justify-content: space-between; align-items: center; }
        .settle-btn { background: var(--accent); color: white; border: none; padding: 5px 10px; border-radius: 8px; font-size: 10px; font-weight: bold; cursor: pointer; }

        /* Hidden Statement Template */
        #statement-export { position: absolute; left: -9999px; width: 500px; background: white; color: black; padding: 40px; }
        .stmt-header { border-bottom: 3px solid #000; padding-bottom: 10px; text-align: center; margin-bottom: 20px; }
        .stmt-table { width: 100%; border-collapse: collapse; }
        .stmt-table th, .stmt-table td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 style="margin:0;">THE AI HUB</h1>
        <p style="color:#9ca3af; font-size: 13px;">Founder: Harshwardhan Singh Lodhi (Karan)</p>
        <div style="margin-top:10px;">
            <a href="#" class="pill">IIT PATNA AI/ML</a>
            <a href="https://www.instagram.com/_verma_karan08" class="pill">INSTAGRAM</a>
        </div>
    </header>

    <div class="stats-grid">
        <div class="stat-card">
            <div style="font-size:10px; color:#9ca3af;">TOTAL PENDING DEBT</div>
            <div class="stat-value" id="dispDebt" style="color:var(--danger)">‚Çπ0</div>
        </div>
        <div class="stat-card">
            <div style="font-size:10px; color:#9ca3af;">TOTAL CASH RECEIVED</div>
            <div class="stat-value" id="dispProfit" style="color:var(--accent)">‚Çπ0</div>
        </div>
    </div>

    <div class="glass-panel" style="border-color: var(--primary);">
        <h3 style="margin:0; font-size: 14px; color:var(--primary);">üîç SEARCH & DOWNLOAD STATEMENT</h3>
        <input type="text" id="findCust" placeholder="Type customer name..." onkeyup="checkLedger()">
        
        <div id="searchResult">
            <div style="font-size: 14px;">Customer: <b id="resName"></b></div>
            <div style="font-size: 22px; font-weight: 900; color: var(--danger); margin: 10px 0;">Total Pending: <span id="resTotal">‚Çπ0</span></div>
            <button id="btnDlAll" class="dl-all-btn" onclick="downloadFullStatement()">üì• DOWNLOAD FULL STATEMENT (PNG)</button>
            <div id="resList" style="max-height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <div class="glass-panel">
        <h3>üìÑ CREATE NEW INVOICE</h3>
        <input type="text" id="custName" placeholder="Customer Name">
        <textarea id="itemList" rows="3" placeholder="Items (e.g. Rice 500)"></textarea>
        <select id="payStatus">
            <option value="Credit">Credit (Debt)</option>
            <option value="Paid">Paid (Cash)</option>
        </select>
        <button class="btn-action" onclick="saveRecord()">GENERATE & DOWNLOAD BILL</button>
    </div>

    <h3 style="padding-left:10px; font-size: 12px; color:#6b7280;">RECENT ACTIVITY</h3>
    <div id="historyBody"></div>
</div>

<div id="statement-export">
    <div class="stmt-header">
        <h1 style="margin:0;">THE AI HUB</h1>
        <p style="margin:0;">OFFICIAL ACCOUNT STATEMENT</p>
        <p style="font-size:12px;">Rajnandgaon, Chhattisgarh | Founder: Karan Lodhi</p>
    </div>
    <div style="margin-bottom: 20px;">
        <p><b>CUSTOMER NAME:</b> <span id="stName" style="text-transform: uppercase;"></span></p>
        <p><b>STATEMENT DATE:</b> <span id="stDate"></span></p>
    </div>
    <table class="stmt-table">
        <thead>
            <tr style="background: #f0f0f0;">
                <th>Date</th>
                <th>Items Detail</th>
                <th style="text-align: right;">Amount</th>
            </tr>
        </thead>
        <tbody id="stRows"></tbody>
    </table>
    <div style="text-align: right; font-size: 24px; font-weight: 900; margin-top: 20px; border-top: 3px solid #000; padding-top: 10px;">
        TOTAL DUE: <span id="stTotal"></span>
    </div>
    <div style="margin-top: 50px; text-align: center; color: #888; font-size: 12px;">
        <p>This is a system-generated statement from THE AI HUB.</p>
        <p>IIT Patna AI/ML Student Managed Ledger</p>
    </div>
</div>

<script>
    let logs = JSON.parse(localStorage.getItem('aih_v9_statement')) || [];

    function saveRecord() {
        const name = document.getElementById('custName').value.trim();
        const list = document.getElementById('itemList').value.trim();
        const status = document.getElementById('payStatus').value;
        if(!name || !list) return alert("Please enter name and items!");

        const now = new Date();
        const timeStr = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        
        logs.push({ id: Date.now(), name, list, status, date: timeStr });
        localStorage.setItem('aih_v9_statement', JSON.stringify(logs));
        renderAll();
        checkLedger();
        document.getElementById('custName').value = "";
        document.getElementById('itemList').value = "";
    }

    function checkLedger() {
        const q = document.getElementById('findCust').value.toLowerCase();
        const resBox = document.getElementById('searchResult');
        if(!q) { resBox.style.display = 'none'; return; }

        resBox.style.display = 'block';
        let totalDebt = 0, detailsHtml = '';
        let found = false;

        logs.forEach(e => {
            if(e.name.toLowerCase().includes(q) && e.status === "Credit") {
                found = true;
                let currentTotal = 0;
                e.list.split('\n').forEach(l => { 
                    let p = parseFloat(l.trim().split(' ').pop()); 
                    if(!isNaN(p)) currentTotal += p; 
                });
                totalDebt += currentTotal;
                detailsHtml += `<div style="font-size:11px; padding:8px 0; border-bottom:1px solid #333; color:#9ca3af;">
                    üìÖ ${e.date} | üí∞ ‚Çπ${currentTotal} | <button onclick="settleBill(${e.id})" class="settle-btn">SETTLE</button>
                </div>`;
            }
        });

        document.getElementById('resName').innerText = q.toUpperCase();
        document.getElementById('resTotal').innerText = '‚Çπ' + totalDebt;
        document.getElementById('resList').innerHTML = detailsHtml || 'No pending debt.';
        document.getElementById('btnDlAll').style.display = (totalDebt > 0) ? 'block' : 'none';
    }

    function downloadFullStatement() {
        const q = document.getElementById('findCust').value.toLowerCase();
        if(!q) return;

        let total = 0, rowsHtml = '';
        logs.forEach(e => {
            if(e.name.toLowerCase().includes(q) && e.status === "Credit") {
                let subTotal = 0;
                e.list.split('\n').forEach(l => { let p = parseFloat(l.trim().split(' ').pop()); if(!isNaN(p)) subTotal += p; });
                total += subTotal;
                rowsHtml += `<tr>
                    <td style="font-size:12px;">${e.date}</td>
                    <td style="font-size:12px;">${e.list.replace(/\n/g, ', ')}</td>
                    <td style="text-align:right;">‚Çπ${subTotal}</td>
                </tr>`;
            }
        });

        document.getElementById('stName').innerText = q;
        document.getElementById('stDate').innerText = new Date().toLocaleDateString();
        document.getElementById('stRows').innerHTML = rowsHtml;
        document.getElementById('stTotal').innerText = '‚Çπ' + total;

        html2canvas(document.getElementById('statement-export')).then(canvas => {
            const link = document.createElement('a');
            link.download = `Statement_${q}.png`;
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function settleBill(id) {
        if(!confirm("Mark as Paid?")) return;
        const index = logs.findIndex(i => i.id === id);
        if(index !== -1) {
            logs[index].status = "Paid";
            localStorage.setItem('aih_v9_statement', JSON.stringify(logs));
            renderAll();
            checkLedger();
        }
    }

    function renderAll() {
        let debt = 0, profit = 0, html = '';
        logs.slice().reverse().forEach(r => {
            let t = 0;
            r.list.split('\n').forEach(l => { let p = parseFloat(l.trim().split(' ').pop()); if(!isNaN(p)) t += p; });
            if(r.status === "Credit") debt += t; else profit += t;

            html += `<div class="history-item">
                <div style="font-size:13px;"><b>${r.name}</b><br><small style="color:gray">${r.date}</small></div>
                <div style="text-align:right;">
                    <b style="color:${r.status === 'Credit' ? 'var(--danger)' : 'var(--accent)'}">‚Çπ${t}</b><br>
                    ${r.status === 'Credit' ? `<button onclick="settleBill(${r.id})" class="settle-btn">SETTLE</button>` : '<span style="font-size:10px; color:var(--accent)">PAID</span>'}
                </div>
            </div>`;
        });
        document.getElementById('dispDebt').innerText = '‚Çπ' + debt;
        document.getElementById('dispProfit').innerText = '‚Çπ' + profit;
        document.getElementById('historyBody').innerHTML = html || '<p style="text-align:center; color:gray;">No data</p>';
    }

    renderAll();
</script>
</body>
</html>
