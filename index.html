<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE AI HUB | Final Ledger by Karan</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #6366f1; --bg: #030712; --card: #111827; --text: #f3f4f6; --accent: #10b981; --danger: #ef4444; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .container { max-width: 600px; margin: auto; }
        header { text-align: center; padding: 25px 0; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
        .pill { background: rgba(99, 102, 241, 0.1); color: var(--primary); padding: 5px 12px; border-radius: 50px; font-size: 11px; text-decoration: none; border: 1px solid var(--primary); font-weight: bold; margin: 0 5px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-value { font-size: 22px; font-weight: 800; margin-top: 5px; }
        .glass-panel { background: rgba(17, 24, 39, 0.7); border: 1px solid rgba(255,255,255,0.05); border-radius: 24px; padding: 20px; margin-bottom: 20px; }
        input, textarea, select { width: 100%; padding: 14px; margin: 10px 0; border-radius: 12px; border: 1px solid #374151; background: #1f2937; color: white; box-sizing: border-box; outline: none; }
        .btn-action { width: 100%; padding: 16px; border-radius: 14px; border: none; font-weight: 800; cursor: pointer; background: var(--primary); color: white; }
        
        /* Search Box Results */
        #searchResult { margin-top: 15px; padding: 15px; border-radius: 15px; background: rgba(99, 102, 241, 0.1); border: 1px dashed var(--primary); display: none; }
        .dl-all-btn { background: var(--danger); color: white; border: none; padding: 12px; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; margin-bottom: 10px; }
        
        .history-item { background: #111827; padding: 15px; border-radius: 15px; margin-bottom: 10px; border: 1px solid #1f2937; display: flex; justify-content: space-between; align-items: center; }
        .btn-group { display: flex; gap: 5px; margin-top: 5px; }
        .mini-btn { border: none; padding: 6px 10px; border-radius: 6px; font-size: 10px; font-weight: bold; cursor: pointer; color: white; }
        .dl-btn { background: #4b5563; }
        .settle-btn { background: var(--accent); }

        /* Hidden Export Templates */
        #bill-export, #statement-export { position: absolute; left: -9999px; width: 450px; background: white; color: black; padding: 40px; }
        .stmt-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .stmt-table th, .stmt-table td { border-bottom: 1px solid #ddd; padding: 10px; text-align: left; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 style="margin:0;">THE AI HUB</h1>
        <p style="color:#9ca3af; font-size: 13px;">Founder: Harshwardhan Singh Lodhi (Karan)</p>
        <div style="margin-top:10px;">
            <span class="pill">IIT PATNA AI/ML</span>
            <a href="https://www.instagram.com/_verma_karan08" target="_blank" class="pill">INSTAGRAM</a>
        </div>
    </header>

    <div class="stats-grid">
        <div class="stat-card">
            <div style="font-size:10px; color:#9ca3af;">TOTAL PENDING DEBT</div>
            <div class="stat-value" id="dispDebt" style="color:var(--danger)">‚Çπ0</div>
        </div>
        <div class="stat-card">
            <div style="font-size:10px; color:#9ca3af;">TOTAL CASH RECEIVED</div>
            <div class="stat-value" id="dispProfit" style="color:var(--accent)">‚Çπ0</div>
        </div>
    </div>

    <div class="glass-panel" style="border: 1px solid var(--primary);">
        <h3>üîç SEARCH & STATEMENT</h3>
        <input type="text" id="findCust" placeholder="Enter name to see full udhari..." onkeyup="checkLedger()">
        <div id="searchResult">
            <div style="font-size: 14px;">Customer: <b id="resName"></b></div>
            <div style="font-size: 20px; font-weight: 900; color: var(--danger); margin: 5px 0;">Total Pending: <span id="resTotal">‚Çπ0</span></div>
            <button id="btnDlAll" class="dl-all-btn" onclick="downloadFullStatement()">üì• DOWNLOAD FULL STATEMENT (PNG)</button>
            <div id="resList" style="max-height: 200px; overflow-y: auto; font-size: 11px; color:#9ca3af;"></div>
        </div>
    </div>

    <div class="glass-panel">
        <h3>üìÑ NEW ENTRY</h3>
        <input type="text" id="custName" placeholder="Customer Name">
        <textarea id="itemList" rows="2" placeholder="Item Name Price (Aalu 50)"></textarea>
        <select id="payStatus">
            <option value="Paid">Paid (Profit)</option>
            <option value="Credit">Credit (Udhari)</option>
        </select>
        <button class="btn-action" onclick="saveRecord()">SAVE RECORD</button>
    </div>

    <h3 style="padding-left:10px; font-size: 12px; color:#6b7280;">HISTORY</h3>
    <div id="historyBody"></div>
</div>

<div id="bill-export">
    <div style="text-align:center; border-bottom:3px solid #000; padding-bottom:10px;">
        <h1 style="margin:0;">THE AI HUB</h1>
        <p style="margin:0; font-size:12px;">Official Invoice | Rajnandgaon, CG</p>
    </div>
    <div style="margin:20px 0; display:flex; justify-content:space-between; font-size:13px;">
        <div><b>CLIENT:</b> <span id="rCust"></span><br><b>STATUS:</b> <span id="rStatus"></span></div>
        <div style="text-align:right;"><b>DATE:</b> <span id="rDate"></span></div>
    </div>
    <table style="width:100%; border-collapse:collapse;" id="rTable"></table>
    <div style="text-align:right; font-size:20px; font-weight:900; border-top:2px solid #000; margin-top:10px; padding-top:10px;">TOTAL: <span id="rGrand"></span></div>
    <div style="margin-top:40px; text-align:center; font-size:10px; color:#666;">Proprietor: Karan Lodhi | IIT Patna</div>
</div>

<div id="statement-export">
    <div style="text-align:center; border-bottom:3px solid #000; padding-bottom:10px;">
        <h1 style="margin:0;">THE AI HUB</h1>
        <p style="margin:0; font-size:12px;">FULL ACCOUNT STATEMENT (PENDING DEBT)</p>
    </div>
    <div style="margin:20px 0; font-size:14px;">
        <b>CUSTOMER:</b> <span id="stCust" style="text-transform:uppercase;"></span><br>
        <b>PRINTED ON:</b> <span id="stPrintDate"></span>
    </div>
    <table class="stmt-table">
        <thead><tr style="background:#f0f0f0;"><th>Date</th><th>Items</th><th>Amount</th></tr></thead>
        <tbody id="stBody"></tbody>
    </table>
    <div style="text-align:right; font-size:22px; font-weight:900; border-top:2px solid #000; margin-top:15px; padding-top:10px;">TOTAL DUE: <span id="stTotal"></span></div>
</div>

<script>
    let logs = JSON.parse(localStorage.getItem('aih_v12_fixed')) || [];

    function saveRecord() {
        const name = document.getElementById('custName').value.trim();
        const list = document.getElementById('itemList').value.trim();
        const status = document.getElementById('payStatus').value;
        if(!name || !list) return alert("Bhai, details bhariye!");
        
        const timeStr = new Date().toLocaleDateString() + ' ' + new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        logs.push({ id: Date.now(), name, list, status, date: timeStr });
        localStorage.setItem('aih_v12_fixed', JSON.stringify(logs));
        
        renderAll();
        document.getElementById('custName').value = "";
        document.getElementById('itemList').value = "";
        alert("Record Saved Successfully!");
    }

    function checkLedger() {
        const q = document.getElementById('findCust').value.toLowerCase();
        const resBox = document.getElementById('searchResult');
        if(!q) { resBox.style.display = 'none'; return; }
        
        resBox.style.display = 'block';
        let totalDebt = 0;
        let listHtml = '';
        
        logs.forEach(e => {
            if(e.name.toLowerCase().includes(q) && e.status === "Credit") {
                let subTotal = 0;
                e.list.split('\n').forEach(l => { let p = parseFloat(l.trim().split(' ').pop()); if(!isNaN(p)) subTotal += p; });
                totalDebt += subTotal;
                listHtml += `<div>‚Ä¢ ${e.date} - ‚Çπ${subTotal}</div>`;
            }
        });
        
        document.getElementById('resName').innerText = q.toUpperCase();
        document.getElementById('resTotal').innerText = '‚Çπ' + totalDebt;
        document.getElementById('resList').innerHTML = listHtml || 'Sab Clear Hai!';
        document.getElementById('btnDlAll').style.display = totalDebt > 0 ? 'block' : 'none';
    }

    function downloadFullStatement() {
        const q = document.getElementById('findCust').value.toLowerCase();
        let total = 0, rows = '';
        
        logs.forEach(e => {
            if(e.name.toLowerCase().includes(q) && e.status === "Credit") {
                let subTotal = 0;
                e.list.split('\n').forEach(l => { let p = parseFloat(l.trim().split(' ').pop()); if(!isNaN(p)) subTotal += p; });
                total += subTotal;
                rows += `<tr><td>${e.date}</td><td>${e.list.replace(/\n/g, ', ')}</td><td>‚Çπ${subTotal}</td></tr>`;
            }
        });

        document.getElementById('stCust').innerText = q;
        document.getElementById('stPrintDate').innerText = new Date().toLocaleDateString();
        document.getElementById('stBody').innerHTML = rows;
        document.getElementById('stTotal').innerText = '‚Çπ' + total;

        html2canvas(document.getElementById('statement-export')).then(canvas => {
            const link = document.createElement('a');
            link.download = `Statement_${q}.png`;
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function downloadBill(id) {
        const r = logs.find(i => i.id === id);
        if(!r) return;
        document.getElementById('rCust').innerText = r.name;
        document.getElementById('rDate').innerText = r.date;
        document.getElementById('rStatus').innerText = r.status.toUpperCase();
        let total = 0, rows = '';
        r.list.split('\n').forEach(line => {
            const p = line.trim().split(' ');
            const price = parseFloat(p.pop());
            if(!isNaN(price)) { total += price; rows += `<tr><td style="padding:8px; border-bottom:1px solid #eee;">${line.replace(price, '')}</td><td style="text-align:right;">‚Çπ${price}</td></tr>`; }
        });
        document.getElementById('rTable').innerHTML = rows;
        document.getElementById('rGrand').innerText = '‚Çπ' + total;
        
        html2canvas(document.getElementById('bill-export')).then(canvas => {
            const link = document.createElement('a');
            link.download = `Bill_${r.name}.png`;
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function settleBill(id) {
        if(!confirm("Paisa mil gaya?")) return;
        const index = logs.findIndex(i => i.id === id);
        if(index !== -1) {
            logs[index].status = "Paid";
            localStorage.setItem('aih_v12_fixed', JSON.stringify(logs));
            renderAll();
            checkLedger();
        }
    }

    function renderAll() {
        let debt = 0, profit = 0, html = '';
        logs.slice().reverse().forEach(r => {
            let t = 0;
            r.list.split('\n').forEach(l => { let p = parseFloat(l.trim().split(' ').pop()); if(!isNaN(p)) t += p; });
            if(r.status === "Credit") debt += t; else profit += t;
            html += `<div class="history-item">
                <div><b>${r.name}</b><br><small style="color:gray">${r.date}</small></div>
                <div style="text-align:right;">
                    <b style="color:${r.status === 'Credit' ? 'var(--danger)' : 'var(--accent)'}">‚Çπ${t}</b>
                    <div class="btn-group">
                        <button class="mini-btn dl-btn" onclick="downloadBill(${r.id})">BILL</button>
                        ${r.status === 'Credit' ? `<button class="mini-btn settle-btn" onclick="settleBill(${r.id})">SETTLE</button>` : ''}
                    </div>
                </div>
            </div>`;
        });
        document.getElementById('dispDebt').innerText = '‚Çπ' + debt;
        document.getElementById('dispProfit').innerText = '‚Çπ' + profit;
        document.getElementById('historyBody').innerHTML = html || '<p style="text-align:center; color:gray;">Empty</p>';
    }
    renderAll();
</script>
</body>
</html>
